function clickNode(e,a){a.findTreeParentLink();e||(selectedNode=[]),selectedNode.push(a)}function getSelectedNode(){return selectedNode}function resetClick(){selectedNode=[]}function doubleClickNode(e,a){var t=a.part.adornedPart;prompt("Name : ",t.data.n)}function setContextNode(){var e;return e=$(go.Adornment,"Vertical",$("ContextMenuButton",$(go.TextBlock,"add daughter"),{click:addChild}),$("ContextMenuButton",$(go.TextBlock,"add son"),{click:addChild}),$("ContextMenuButton",$(go.TextBlock,"add spouse"),{click:addSpouse}),$("ContextMenuButton",$(go.TextBlock,"Edit Node"),{click:editNode}))}function addChild(e,a){var t=a.elt(1).text;alert(t);var o={n:"newNode"};"add son"==t?o={n:"newNode",s:"M"}:"add daughter"==t&&(o={n:"newNode",s:"F"});var n,r,i=a.part.adornedPart;if(i.findNodesOutOf().each(function(e){r=findMarriage(myDiagram,e.data.key,i.data.key),alert(r.data.category),n=e.data.key}),null==r){var d=[];i.findNodesInto().each(function(e){d.push(e.data.key)});var n=d[0].split(",");n=n[0],r=findMarriage(myDiagram,n[0],i.data.key),alert(r.data.category+" with :"+n)}"F"==i.data.s&&"Marriage"==r.data.category&&(o.m=i.data.key,o.f=n),myDiagram.startTransaction("add node and link"),myDiagram.model.addNodeData(o);var l=r.data,s=l.labelKeys[0],c={from:s,to:o.key};myDiagram.model.addLinkData(c),myDiagram.model.addLinkData(newlink),myDiagram.commitTransaction("add node and link")}function editNode(e,a){var t=a.part.adornedPart.data,o=prompt("Name : ",a.part.adornedPart.data.n);myDiagram.model.startTransaction("modified Node"),myDiagram.model.setDataProperty(t,"n",o),myDiagram.model.commitTransaction("modified Node")}function addSpouse(e,a){var t=a.part.adornedPart,o={n:"Spouse",cou:t.data.key};"M"==t.data.s?o.s="F":"F"==t.data.s&&(o.s="M"),myDiagram.startTransaction("add Spouse"),myDiagram.model.addNodeData(o);t.data;myDiagram.commitTransaction("add Spouse"),setupMarriages(myDiagram),setupParents(myDiagram)}function init(e){function a(e){switch(e){case"A":return"green";case"B":return"orange";case"C":return"red";case"D":return"cyan";case"E":return"gold";case"F":return"pink";case"G":return"blue";case"H":return"brown";case"I":return"purple";case"J":return"chartreuse";case"K":return"lightgray";case"L":return"magenta";case"S":return"red";default:return"transparent"}}function t(e){switch(e){case"A":return n;case"B":return n;case"C":return n;case"D":return r;case"E":return r;case"F":return r;case"G":return i;case"H":return i;case"I":return i;case"J":return d;case"K":return d;case"L":return d;case"S":return l;default:return n}}function o(e){switch(e){case"A":return s;case"B":return s;case"C":return s;case"D":return c;case"E":return c;case"F":return c;case"G":return g;case"H":return g;case"I":return g;case"J":return u;case"K":return u;case"L":return u;case"S":return l;default:return s}}alert(JSON.stringify(e)),myDiagram=$(go.Diagram,"myDiagram",{initialAutoScale:go.Diagram.Uniform,initialContentAlignment:go.Spot.Center,click:resetClick,nodeSelectionAdornmentTemplate:$(go.Adornment,"Auto",{layerName:"Grid"},$(go.Shape,"Circle",{fill:"yellow",stroke:null}),$(go.Placeholder)),layout:$(GenogramLayout,{direction:90,layerSpacing:30,columnSpacing:10})}),myDiagram.allowDrop=!0;var n=go.Geometry.parse("F M1 1 l19 0 0 19 -19 0z"),r=go.Geometry.parse("F M20 1 l19 0 0 19 -19 0z"),i=go.Geometry.parse("F M20 20 l19 0 0 19 -19 0z"),d=go.Geometry.parse("F M1 20 l19 0 0 19 -19 0z"),l=go.Geometry.parse("F M38 0 L40 0 40 2 2 40 0 40 0 38z"),s=go.Geometry.parse("F M20 20 B 180 90 20 20 19 19 z"),c=go.Geometry.parse("F M20 20 B 270 90 20 20 19 19 z"),g=go.Geometry.parse("F M20 20 B 0 90 20 20 19 19 z"),u=go.Geometry.parse("F M20 20 B 90 90 20 20 19 19 z");myDiagram.nodeTemplateMap.add("M",$(go.Node,"Vertical",{locationSpot:go.Spot.Center,locationObjectName:"ICON"},{doubleClick:doubleClickNode,click:function(e,a){clickNode(window.event.ctrlKey,a)},selectionAdornmentTemplate:$(go.Adornment,"Spot",$(go.Panel,"Auto",$(go.Shape,{fill:null,stroke:"dodgerblue",strokeWidth:3}),$(go.Placeholder))),contextMenu:setContextNode()},$(go.Panel,{name:"ICON"},$(go.Shape,"Square",{width:40,height:40,strokeWidth:2,fill:"white",portId:""}),$(go.Panel,{itemTemplate:$(go.Panel,$(go.Shape,{stroke:null,strokeWidth:0},new go.Binding("fill","",a),new go.Binding("geometry","",t))),margin:1},new go.Binding("itemArray","a"))),$(go.TextBlock,{textAlign:"center",maxSize:new go.Size(80,0/0)},new go.Binding("text","n")))),myDiagram.nodeTemplateMap.add("F",$(go.Node,"Vertical",{locationSpot:go.Spot.Center,locationObjectName:"ICON"},{doubleClick:doubleClickNode,click:function(e,a){clickNode(window.event.ctrlKey,a)},selectionAdornmentTemplate:$(go.Adornment,"Spot",$(go.Panel,"Auto",$(go.Shape,{fill:null,stroke:"dodgerblue",strokeWidth:3}),$(go.Placeholder))),contextMenu:setContextNode()},$(go.Panel,{name:"ICON"},$(go.Shape,"Circle",{width:40,height:40,strokeWidth:2,fill:"white",portId:""}),$(go.Panel,{itemTemplate:$(go.Panel,$(go.Shape,{stroke:null,strokeWidth:0},new go.Binding("fill","",a),new go.Binding("geometry","",o))),margin:1},new go.Binding("itemArray","a"))),$(go.TextBlock,{textAlign:"center",maxSize:new go.Size(80,0/0)},new go.Binding("text","n")))),myDiagram.nodeTemplateMap.add("LinkLabel",$(go.Node,{selectable:!1,width:1,height:1,fromEndSegmentLength:20})),myDiagram.linkTemplate=$(go.Link,{routing:go.Link.Orthogonal,curviness:10,layerName:"Background",selectable:!1,fromSpot:go.Spot.Bottom,toSpot:go.Spot.Top},$(go.Shape,{strokeWidth:2})),myDiagram.linkTemplateMap.add("Marriage",$(go.Link,{selectable:!1},$(go.Shape,{strokeWidth:2,stroke:"darkgreen"}))),setupDiagram(myDiagram,e,1)}function setupDiagram(e,a,t){e.model=go.GraphObject.make(go.GraphLinksModel,{linkLabelKeysProperty:"labelKeys",nodeCategoryProperty:"s",nodeDataArray:a}),setupMarriages(e),setupParents(e),myDiagram=e;var o=e.findNodeForKey(t);null!==o&&(e.select(o),o.linksConnected.each(function(e){if(e.isLabeledLink){e.opacity=0;var a=e.getOtherNode(o);a.opacity=0,a.pickable=!1}}))}function findMarriage(e,a,t){var o=e.findNodeForKey(a),n=e.findNodeForKey(t);if(null!==o&&null!==n)for(var r=o.findLinksBetween(n);r.next();){var i=r.value;if(null!==i.data)return i}return null}function setupMarriages(e){for(var a=e.model,t=a.nodeDataArray,o=0;o<t.length;o++){var n=t[o],r=n.key,i=n.cou;if(void 0!==i){"number"==typeof i&&(i=[i]);for(var d=0;d<i.length;d++){var l=i[d];if(r!==l){var s=findMarriage(e,r,l);if(null===s){var c={s:"LinkLabel"};a.addNodeData(c);var g={from:r,to:l,labelKeys:[c.key],category:"Marriage"};a.addLinkData(g)}}}}}}function setupParents(e){for(var a=e.model,t=a.nodeDataArray,o=0;o<t.length;o++){var n=t[o],r=n.key,i=n.m,d=n.f;if(void 0!==i&&void 0!==d){var l=findMarriage(e,i,d);if(null===l){window.console&&window.console.log("unknown marriage: "+i+" & "+d);continue}var s=l.data,c=s.labelKeys[0],g={from:c,to:r};myDiagram.model.addLinkData(g)}}diagramGlobal=e}function GenogramLayout(){go.LayeredDigraphLayout.call(this),this.initializeOption=go.LayeredDigraphLayout.InitDepthFirstIn}function addNode(e){myDiagram.startTransaction("new node");var e={key:5,n:New,s:F,m:2,f:3,a:[B,H]};myDiagram.model.addNodeData(e),part=myDiagram.findPartForData(e),part.location=myDiagram.toolManager.contextMenuTool.mouseDownPoint,myDiagram.commitTransaction("new node")}function openFile(e){var a=e.target,t=[],o=new FileReader;o.onload=function(){function e(e){for(var a=e.split(","),t={},o=0;o<a.length;o++){var n=a[o].split(":"),r=n[0],i=n[1];"a"==r&&(i=i.split("")),t[r]=i}return t}for(var a=o.result,n=a.split("\r\n"),r=0;r<n.length;r++)t.push(e(n[r]));init(t)},o.readAsText(a.files[0])}function changeData(){var e=[{key:1,n:"Hello"},{key:2,n:"World"}];init(e),setupDiagram(myDiagram,e,1)}var selectedNode=[],JsonData=[],diagramGlobal,myDiagram,$=go.GraphObject.make;go.Diagram.inherit(GenogramLayout,go.LayeredDigraphLayout),GenogramLayout.prototype.makeNetwork=function(e){var a=this.createNetwork();return e instanceof go.Diagram?(this.add(a,e.nodes,!0),this.add(a,e.links,!0)):e instanceof go.Group?this.add(a,e.memberParts,!1):e.iterator&&this.add(a,e.iterator,!1),a},GenogramLayout.prototype.add=function(e,a,t){for(var o=a.iterator;o.next();){var n=o.value;if(n instanceof go.Node&&n.isLayoutPositioned&&n.isVisible()&&(!t||null===n.containingGroup))if(n.isLinkLabel){var r=n.labeledLink,i=r.fromNode,d=r.toNode,l=e.addNode(n);l.width=i.actualBounds.width+30+d.actualBounds.width,l.height=Math.max(i.actualBounds.height,d.actualBounds.height),l.focus=new go.Point(i.actualBounds.width+15,l.height/2)}else if(!n.linksConnected.any(function(e){return e.isLabeledLink}))var l=e.addNode(n)}for(o.reset();o.next();){var r=o.value;if(r instanceof go.Link&&r.isLayoutPositioned&&r.isVisible()&&!(t&&null!==r.containingGroup||r.isLabeledLink)){var s=e.findVertex(r.fromNode),c=e.findVertex(r.toNode);null!==c?e.linkVertexes(s,c,r):r.toNode.linksConnected.each(function(a){if(a.isLabeledLink){var t=a.labelNodes.first(),o=e.findVertex(t);null!==o&&e.linkVertexes(s,o,r)}})}}},GenogramLayout.prototype.assignLayers=function(){go.LayeredDigraphLayout.prototype.assignLayers.call(this);var e=0==this.direction||180==this.direction,a=[];this.network.vertexes.each(function(t){var o=t.layer,n=a[o];void 0===n&&(n=0);var r=e?t.width:t.height;r>n&&(a[o]=r)}),this.network.vertexes.each(function(t){var o=t.layer,n=a[o];e?(t.focus=new go.Point(0,t.height/2),t.width=n):(t.focus=new go.Point(t.width/2,0),t.height=n)})},GenogramLayout.prototype.commitNodes=function(){go.LayeredDigraphLayout.prototype.commitNodes.call(this),this.network.vertexes.each(function(e){null===e.node||e.node.isLinkLabel||(e.node.position=new go.Point(e.x,e.y))});var e=this;this.network.vertexes.each(function(a){if(null!==a.node&&a.node.isLinkLabel){var t=a.node,o=t.labeledLink;o.invalidateRoute();var n=o.fromNode,r=o.toNode;if("F"===n.data.s){var i=n;n=r,r=i}var d=e.findParentsMarriageLabelNode(n),l=e.findParentsMarriageLabelNode(r);if(null!==d&&null!==l&&d.position.x>l.position.x){var i=n;n=r,r=i}if(n.position=new go.Point(a.x,a.y),r.position=new go.Point(a.x+n.actualBounds.width+30,a.y),0===n.opacity){var s=new go.Point(a.centerX-n.actualBounds.width/2,a.y);n.position=s,r.position=s}else if(0===r.opacity){var s=new go.Point(a.centerX-r.actualBounds.width/2,a.y);n.position=s,r.position=s}}})},GenogramLayout.prototype.findParentsMarriageLabelNode=function(e){for(var a=e.findNodesInto();a.next();){var t=a.value;if(t.isLinkLabel)return t}return null};
//# sourceMappingURL=enGeno.min.js.map